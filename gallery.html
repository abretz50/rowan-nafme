<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rowan NAfME — Gallery</title>
  <meta name="color-scheme" content="light">
  <link rel="icon" href="/images/logo.png">
  <link rel="stylesheet" href="/assets/css/style.css">

  <style>
    .gallery-toolbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .gallery-toolbar .actions{ display:flex; gap:10px; flex-wrap:wrap; }

    /* Masonry layout (columns) */
    .masonry{ column-gap: 12px; column-count: 4; }
    @media (max-width: 1200px){ .masonry{ column-count: 3; } }
    @media (max-width: 900px){  .masonry{ column-count: 2; } }
    @media (max-width: 560px){  .masonry{ column-count: 1; } }

    .masonry .item{
      break-inside: avoid; -webkit-column-break-inside: avoid; page-break-inside: avoid;
      margin: 0 0 12px 0;
      display: block;
      border-radius: 14px;
      overflow: hidden;
      background: rgba(255,255,255,.06);
      border: 1.6px solid var(--border);
      box-shadow: var(--shadow);
      transition: transform .12s ease, filter .2s ease;
      cursor: zoom-in;
    }
    .masonry .item:hover{ transform: translateY(-2px); filter: brightness(1.03); }

    .masonry .item img{
      width: 100%; height: auto; display: block; object-fit: cover;
      background: rgba(0,0,0,.18);
    }

    /* Lightbox */
    .lightbox{ position: fixed; inset:0; display:none; place-items:center; background: rgba(0,0,0,.6); z-index: 9999; }
    .lightbox.open{ display:grid; }
    .lightbox-inner{
      max-width: min(92vw, 1400px);
      max-height: 86vh;
      display: grid; place-items:center;
      border-radius: 16px; overflow:hidden;
      background: #111;
      box-shadow: 0 30px 70px rgba(0,0,0,.45);
      position: relative;
    }
    .lightbox img{ width: 100%; height: 100%; object-fit: contain; background: #000; }
    .lightbox .close{
      position:absolute; top:10px; right:10px;
      background: rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.25);
      height: 40px; min-width: 40px; border-radius: 999px; color:#fff; font-weight:800;
      display:inline-grid; place-items:center; cursor:pointer;
    }

    .empty, .error{ padding: 10px; }
  </style>
</head>
<body>
  <nav class="site-nav"></nav>

  <header class="hero">
    <div class="hero-inner container">
      <div>
        <h1>Photo Gallery</h1>
        <p>Highlights from Rowan NAfME events, workshops, service, and performances.</p>
        <div class="gallery-toolbar">
          <div class="actions">
            <a class="btn" href="/index.html">← Home</a>
          </div>
          <div id="count" class="subtle"></div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="container">
        <div id="status" class="subtle"></div>
        <div id="gallery" class="masonry" aria-live="polite"></div>
      </div>
    </section>
  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog" hidden>
    <div class="lightbox-inner">
      <button class="close" id="lbClose" aria-label="Close">✕</button>
      <img id="lbImg" alt="">
    </div>
  </div>

  <footer class="site-footer"></footer>
  <script src="/assets/js/nav.js" defer></script>

  <script>
  (function(){
    // Where we’ll look for your file list
    const MANIFEST_URL = "/images/gallery/manifest.json";

    // Optional fallback: paste filenames here if you don’t want a manifest.json yet.
    // Example: [ "workshop-01.jpg", "zoo-violin.png", "pd-guest.webp" ]
    const IMAGES_FALLBACK = []; // fill like ["a.jpg","b.png"]

    const gallery  = document.getElementById("gallery");
    const statusEl = document.getElementById("status");
    const countEl  = document.getElementById("count");

    function toTitle(src){
      const name = (src||"").split("/").pop().replace(/\.[^.]+$/,"");
      return name.replace(/[_-]+/g," ").replace(/\s+/g," ").trim();
    }

    function normalizeList(list){
      // Accept ["a.jpg", ...] or [{src, title, caption}, ...]
      return (list||[]).map(x => {
        if (typeof x === "string") return { src: "/images/gallery/" + x, title: toTitle(x) };
        const src = x.src.startsWith("/") ? x.src : "/images/gallery/" + x.src;
        return { src, title: x.title || toTitle(src), caption: x.caption || "" };
      });
    }

    async function loadManifest(){
      try{
        const res = await fetch(MANIFEST_URL, {cache:"no-store"});
        if (!res.ok) throw new Error("manifest missing");
        const data = await res.json();
        return normalizeList(data);
      }catch(_){
        return normalizeList(IMAGES_FALLBACK);
      }
    }

    function render(items){
      if(!items.length){
        gallery.innerHTML = "<p class='empty'>No photos yet. Add images to <code>/images/gallery</code> and list them in <code>manifest.json</code>.</p>";
        return;
      }
      // newest-first if filenames contain dates; otherwise just render order
      const html = items.map(it => `
        <a class="item" href="${it.src}" data-full="${it.src}" data-title="${it.title}">
          <img loading="lazy" src="${it.src}" alt="${it.title}">
        </a>
      `).join("");
      gallery.innerHTML = html;
      countEl.textContent = items.length + " photos";

      // lightbox
      const lb = document.getElementById("lightbox");
      const lbImg = document.getElementById("lbImg");
      const lbClose = document.getElementById("lbClose");
      function open(full, title){ lbImg.src = full; lbImg.alt = title || ""; lb.classList.add("open"); lb.removeAttribute("hidden"); }
      function close(){ lb.classList.remove("open"); lb.setAttribute("hidden",""); lbImg.src = ""; }
      gallery.querySelectorAll(".item").forEach(a => {
        a.addEventListener("click", (e) => { e.preventDefault(); open(a.dataset.full, a.dataset.title); });
      });
      lb.addEventListener("click", (e) => { if(e.target === lb) close(); });
      lbClose.addEventListener("click", close);
      document.addEventListener("keydown", (e) => { if(e.key === "Escape") close(); });
    }

    (async function init(){
      statusEl.textContent = "Loading photos…";
      const items = await loadManifest();
      statusEl.textContent = "";
      render(items);
    })();
  })();
  </script>
</body>
</html>
